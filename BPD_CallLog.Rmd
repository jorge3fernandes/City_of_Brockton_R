---
title: "Brockton Police Call Log Research"
author: "Jorge Fernandes"
date: "February 7, 2016"
output: html_document
---

<<<<<<< HEAD
By inpecting the  website, you can see that the data is presented in an archive by date. Noticing that will make our extraction easier. we will just manipulate the URL to make it go through the whole archive.
```{r}

library(plyr)
library(RCurl)
library(stringr)
library(pdftables)

```


By examining the urls, sometimes there is no leading zero before days and months less than ten.  

Here I'm creating all the urls with leading zeros where days and months are less than ten.

```{r}

prefix <- "http://brocktonpolice.com/wp-content/uploads/"
AllDays <- seq.Date(from = as.Date('2015-01-01'), to = Sys.Date(), by = "day")
links1 <- paste0(prefix, format(AllDays, '%Y/%m/%m%d%y'), '.pdf')

```

Here I'm creating all the urls with without leading zeros where days and months are less than ten.

```{r}

AllDays_NL <- gsub("0", "", format(AllDays, '%m%d%y'))
links2 <- paste0(prefix, format(AllDays, '%Y/%m/'), AllDays_NL,'.pdf')

```

Since there is not a clear pattern on when we do and don't have a leading zero, we will put the two lists together and extract the data whenever we have a match
```{r , echo = FALSE}

link <- c(links1,links2)

```

Here, we go against the website and download the data.

```{r}
#assiging a new WD to put the PDFs
folder <- paste0(getwd(),"/","Police_logs")
homedir <- "C:/Users/jf82645/Desktop/Kaggle/Rbrockton/RBrockton"
filenames <- str_c(format(seq.Date(from = as.Date("2015-01-01"), to = Sys.Date(), by = "day"),"%Y_%m_%d"),".pdf")
filenames <- c(filenames,filenames)
setwd(folder)
for (i in seq_along(link)) {
      #using trycatch to bipass the error when url doesn't exist
      tryCatch({
      if (!file.exists(str_c(folder,"/",filenames[i]))) { 
                  download.file(link[91], filenames[91], mode = "wb")
      } }, error = function(e){})
      #since we bipassed the error and the file was created anyway, we go in and  
      #check for file size to make sure the file is deleted before the loop checks
      #checks for file name again
      if (is.na(file.info(filenames[i])$size) | file.info(filenames[i])$size == 0) {
            file.remove(filenames[i])
      }
}

```

Since the data is in pdf format, we use pdftools to extract text from the PDFs

```{r}
# I use PDFtools to extract text from PDF

pdf_list <- list.files(path = folder,
                       pattern = ".pdf",
                       full.names = TRUE)

txt_names <- list.files(folder, pattern = "pdf") %>% str_replace(".pdf",".txt")

for (i in seq_along(txt_names)) {
            if (!file.exists(folder[i])) { 
                  write(pdf_text(pdf_list[i]), file = txt_names[i])
            }
           
}

```

###Current effort:
Separanting the events




